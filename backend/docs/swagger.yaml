basePath: /
definitions:
  internal_handler_image.RecognizeImageResponse:
    properties:
      class_name:
        type: string
      status_code:
        $ref: '#/definitions/wsai_backend_internal_common_code.Code'
      status_msg:
        type: string
    type: object
  internal_handler_session.CreateSessionAndSendFirstMessageRequest:
    properties:
      modelType:
        type: string
      question:
        type: string
    required:
    - modelType
    - question
    type: object
  internal_handler_session.GetMeaasgeHistoryResponse:
    properties:
      history:
        items:
          $ref: '#/definitions/wsai_backend_internal_model.History'
        type: array
      status_code:
        $ref: '#/definitions/wsai_backend_internal_common_code.Code'
      status_msg:
        type: string
    type: object
  internal_handler_session.GetUserSessionsResponse:
    properties:
      sessions:
        items:
          $ref: '#/definitions/wsai_backend_internal_model.SessionInfo'
        type: array
      status_code:
        $ref: '#/definitions/wsai_backend_internal_common_code.Code'
      status_msg:
        type: string
    type: object
  internal_handler_session.SendMessageStreamRequest:
    properties:
      modelType:
        type: string
      question:
        type: string
      sessionId:
        type: string
    required:
    - modelType
    - question
    - sessionId
    type: object
  internal_handler_user.CaptchaRequest:
    properties:
      email:
        type: string
    required:
    - email
    type: object
  internal_handler_user.CaptchaResponse:
    properties:
      status_code:
        $ref: '#/definitions/wsai_backend_internal_common_code.Code'
      status_msg:
        type: string
    type: object
  internal_handler_user.LoginRequest:
    properties:
      password:
        type: string
      username:
        type: string
    type: object
  internal_handler_user.LoginResponse:
    properties:
      status_code:
        $ref: '#/definitions/wsai_backend_internal_common_code.Code'
      status_msg:
        type: string
      token:
        type: string
    type: object
  internal_handler_user.RegisterRequest:
    properties:
      captcha:
        type: string
      email:
        type: string
      password:
        type: string
    required:
    - email
    type: object
  internal_handler_user.RegisterResponse:
    properties:
      status_code:
        $ref: '#/definitions/wsai_backend_internal_common_code.Code'
      status_msg:
        type: string
      token:
        type: string
    type: object
  wsai_backend_internal_common.Response:
    properties:
      status_code:
        $ref: '#/definitions/wsai_backend_internal_common_code.Code'
      status_msg:
        type: string
    type: object
  wsai_backend_internal_common_code.Code:
    enum:
    - 1000
    - 2001
    - 2002
    - 2003
    - 2004
    - 2005
    - 2006
    - 2007
    - 2008
    - 2009
    - 2010
    - 3001
    - 4001
    - 5001
    - 5002
    - 5003
    format: int64
    type: integer
    x-enum-varnames:
    - CodeSuccess
    - CodeInvalidParams
    - CodeUserExist
    - CodeUserNotExist
    - CodeInvalidPassword
    - CodeNotMatchPassword
    - CodeInvalidToken
    - CodeNotLogin
    - CodeInvalidCaptcha
    - CodeRecordNotFound
    - CodeIllegalPassword
    - CodeForbidden
    - CodeServerBusy
    - AIModelNotFind
    - AIModelCannotOpen
    - AIModelFail
  wsai_backend_internal_model.History:
    properties:
      content:
        type: string
      is_user:
        type: boolean
    type: object
  wsai_backend_internal_model.SessionInfo:
    properties:
      sessionId:
        type: string
      title:
        type: string
    type: object
host: localhost:9091
info:
  contact: {}
  description: WsAI 项目 Swagger 文档
  title: WsAI Backend API
  version: "1.0"
paths:
  /api/v1/AI/chatMessage/sessions:
    get:
      consumes:
      - application/json
      description: 返回当前登录用户创建的所有聊天会话（通常按创建时间降序）
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_handler_session.GetUserSessionsResponse'
      security:
      - ApiKeyAuth: []
      summary: 获取当前用户的所有会话列表
      tags:
      - 会话管理
  /api/v1/AI/chatMessage/sessions/{session_id}/messages:
    get:
      consumes:
      - application/json
      description: 返回指定会话 ID 下的所有消息记录（按时间升序）
      parameters:
      - description: 会话ID
        in: path
        name: session_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_handler_session.GetMeaasgeHistoryResponse'
      security:
      - ApiKeyAuth: []
      summary: 获取指定会话的全部历史消息
      tags:
      - 会话管理
  /api/v1/AI/chatMessage/sessions/{session_id}/messages/stream:
    post:
      consumes:
      - application/json
      description: 向指定的会话 ID 发送一条新消息，并使用 SSE 流式返回 AI 回答
      parameters:
      - description: 会话ID
        in: path
        name: session_id
        required: true
        type: string
      - description: 请求参数
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/internal_handler_session.SendMessageStreamRequest'
      produces:
      - text/event-stream
      responses:
        "200":
          description: SSE error 事件
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 向已有会话追加消息（SSE 流式返回）
      tags:
      - 会话管理
  /api/v1/AI/chatMessage/sessions/stream:
    post:
      consumes:
      - application/json
      description: 创建一个新会话，同时把用户的第一个问题发给 AI，使用 SSE 流式返回
      parameters:
      - description: 请求参数
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/internal_handler_session.CreateSessionAndSendFirstMessageRequest'
      produces:
      - text/event-stream
      responses:
        "200":
          description: SSE error 事件
          schema:
            type: string
      security:
      - ApiKeyAuth: []
      summary: 创建新会话 + 发送第一个问题（SSE 流式返回）
      tags:
      - 会话管理
  /api/v1/image/recognize:
    post:
      consumes:
      - multipart/form-data
      description: |-
        上传单张图片，服务端返回识别出的主要类别名称

        成功时：code=0，class_name 会有值
        失败时：code 为错误码（1001 参数错误 / 1002 服务器忙等），class_name 为空
      parameters:
      - description: 要识别的图片文件（支持常见图片格式：jpg,png,gif等）
        in: formData
        name: image
        required: true
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: 业务错误（code≠0）也返回 200，这是项目规范
          schema:
            $ref: '#/definitions/internal_handler_image.RecognizeImageResponse'
      summary: 上传图片进行分类/识别
      tags:
      - 图像识别
  /api/v1/user/captcha:
    post:
      consumes:
      - application/json
      description: 向指定邮箱发送注册验证码
      parameters:
      - description: 邮箱参数
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/internal_handler_user.CaptchaRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 验证码发送成功
          schema:
            $ref: '#/definitions/internal_handler_user.CaptchaResponse'
        "400":
          description: 邮箱格式错误
          schema:
            $ref: '#/definitions/wsai_backend_internal_common.Response'
        "429":
          description: 发送过于频繁
          schema:
            $ref: '#/definitions/wsai_backend_internal_common.Response'
      summary: 发送邮箱验证码
      tags:
      - 用户认证
  /api/v1/user/login:
    post:
      consumes:
      - application/json
      description: 根据用户名和密码登录，返回 JWT token
      parameters:
      - description: 登录参数
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/internal_handler_user.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 登录成功，返回 token
          schema:
            $ref: '#/definitions/internal_handler_user.LoginResponse'
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/wsai_backend_internal_common.Response'
        "401":
          description: 用户名或密码错误
          schema:
            $ref: '#/definitions/wsai_backend_internal_common.Response'
      summary: 用户登录
      tags:
      - 用户认证
  /api/v1/user/users:
    post:
      consumes:
      - application/json
      description: 通过邮箱、密码和验证码注册新用户，成功后直接返回登录 token
      parameters:
      - description: 注册参数
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/internal_handler_user.RegisterRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 注册成功，返回 token
          schema:
            $ref: '#/definitions/internal_handler_user.RegisterResponse'
        "400":
          description: 参数错误或验证码错误
          schema:
            $ref: '#/definitions/wsai_backend_internal_common.Response'
        "409":
          description: 用户已存在
          schema:
            $ref: '#/definitions/wsai_backend_internal_common.Response'
      summary: 用户注册
      tags:
      - 用户认证
swagger: "2.0"
